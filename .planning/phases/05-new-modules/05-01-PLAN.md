---
phase: 05-new-modules
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/rust/config.yml
  - modules/rust/files/.zshenv
  - modules/git/files/.config/gh/config.yml
autonomous: true

must_haves:
  truths:
    - "modules/rust/ exists with config.yml and files/.zshenv"
    - "Rust module declares rustup-init homebrew formula"
    - "Rust module .zshenv sources $HOME/.cargo/env"
    - "gh config.yml is in git module stow tree at .config/gh/config.yml"
    - "gh config.yml has git_protocol: https and co alias"
    - "No secrets, tokens, or auth credentials in any committed file"
    - "hosts.yml is NOT committed (contains auth tokens)"
  artifacts:
    - path: "modules/rust/config.yml"
      provides: "Rust module declaration with homebrew formula and mergeable .zshenv"
      contains: "rustup-init"
    - path: "modules/rust/files/.zshenv"
      provides: "Cargo PATH integration for zsh"
      contains: ".cargo/env"
    - path: "modules/git/files/.config/gh/config.yml"
      provides: "GitHub CLI configuration deployed via git module stow"
      contains: "git_protocol: https"
  key_links:
    - from: "modules/rust/files/.zshenv"
      to: "$HOME/.cargo/env"
      via: "source (dot) command"
      pattern: ". \"$HOME/.cargo/env\""
---

<objective>
Create new modules for tools found during audit: Rust toolchain module and gh CLI config in git module.

Purpose: The audit identified Rust and gh CLI config as missing from the dotfiles repo. Both are present on the current machine and can be captured now. Karabiner is blocked (volume disconnected, not installed).

Output: New rust module with config.yml and .zshenv, gh config.yml added to git module's stow tree.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/audit/APPS.md
@.planning/phases/05-new-modules/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Rust module</name>
  <files>
    modules/rust/config.yml
    modules/rust/files/.zshenv
  </files>
  <action>
    Create `modules/rust/` following the speckit module pattern:

    1. **Create `modules/rust/config.yml`:**
       ```yaml
       ---
       # Rust toolchain module
       # Rust programming language via rustup

       # Rust dependencies
       homebrew_packages:
         - rustup-init  # Rust toolchain installer (manages rustc, cargo, etc.)

       stow_dirs:
         - rust

       mergeable_files:
         - ".zshenv"

       # Note: This module provides:
       # - Rust toolchain via rustup (rustc, cargo, clippy, rustfmt)
       # - Cargo PATH integration via .zshenv
       #
       # After deployment, run: rustup-init to initialize the toolchain
       # Or if already initialized, rustup will manage updates
       ```

    2. **Create `modules/rust/files/.zshenv`:**
       ```
       # Rust module contribution to Zsh environment
       # This file will be merged with the main .zshenv file

       # Source Cargo environment (adds ~/.cargo/bin to PATH)
       [[ -f "$HOME/.cargo/env" ]] && . "$HOME/.cargo/env"
       ```
       Note: Guard with `[[ -f ]]` test so it doesn't error if cargo isn't installed yet.

    3. **Security scan:**
       ```
       grep -rEi "(secret|password|token|key)" modules/rust/
       grep -rE "/Users/[^/]+/" modules/rust/
       ```
       Should find nothing.

    4. **Stage and commit:**
       ```
       git add modules/rust/config.yml modules/rust/files/.zshenv
       git commit -m "feat(05-01): add rust toolchain module"
       ```
  </action>
  <verify>
    Run: `ls modules/rust/config.yml modules/rust/files/.zshenv` -- both exist
    Run: `grep rustup-init modules/rust/config.yml` -- found
    Run: `grep cargo modules/rust/files/.zshenv` -- found
  </verify>
  <done>Rust module created with config.yml declaring rustup-init and .zshenv sourcing cargo/env.</done>
</task>

<task type="auto">
  <name>Task 2: Add gh CLI config to git module</name>
  <files>
    modules/git/files/.config/gh/config.yml
  </files>
  <action>
    Add GitHub CLI config to the git module's stow directory:

    1. **Create `modules/git/files/.config/gh/config.yml`:**
       Copy from current machine's `~/.config/gh/config.yml` with these contents:
       ```yaml
       version: 1
       git_protocol: https
       editor:
       prompt: enabled
       prefer_editor_prompt: disabled
       pager:
       aliases:
           co: pr checkout
       http_unix_socket:
       browser:
       color_labels: disabled
       accessible_colors: disabled
       accessible_prompter: disabled
       spinner: enabled
       ```

       **DO NOT** copy or commit:
       - `hosts.yml` (contains auth tokens from `gh auth login`)
       - Any file with oauth_token or other credentials

    2. **Verify the git module stow tree includes gh config:**
       ```
       ls -la modules/git/files/.config/gh/config.yml
       ```
       The existing `.config/git/ignore` in the git module shows this stow tree already
       supports `.config/` subdirectories.

    3. **Security scan:**
       ```
       grep -rEi "(token|secret|password|oauth)" modules/git/files/.config/gh/
       ```
       Should find nothing.

    4. **Stage and commit:**
       ```
       git add modules/git/files/.config/gh/config.yml
       git commit -m "feat(05-01): add gh CLI config to git module"
       ```
  </action>
  <verify>
    Run: `cat modules/git/files/.config/gh/config.yml | grep git_protocol` -- shows "https"
    Run: `cat modules/git/files/.config/gh/config.yml | grep "co:"` -- shows "co: pr checkout"
    Run: `grep -ri token modules/git/files/.config/gh/` -- should find nothing
    Run: `test ! -f modules/git/files/.config/gh/hosts.yml && echo "PASS: no hosts.yml"` -- PASS
  </verify>
  <done>gh CLI config added to git module stow tree. Auth tokens (hosts.yml) excluded.</done>
</task>

</tasks>

<verification>
- modules/rust/config.yml exists and declares rustup-init
- modules/rust/files/.zshenv exists and sources $HOME/.cargo/env
- modules/git/files/.config/gh/config.yml exists with git_protocol: https and co alias
- No hosts.yml or auth tokens committed anywhere
- No secrets, corporate references, or hardcoded paths in any new file
- Two atomic commits created (one per module change)
</verification>

<success_criteria>
1. Rust module is self-contained with config.yml and mergeable .zshenv
2. gh CLI config is part of git module stow deployment
3. No secrets or auth tokens in any committed file
4. Karabiner documented as blocked (volume disconnected, not installed)
</success_criteria>

<output>
After completion, create `.planning/phases/05-new-modules/05-01-SUMMARY.md`
</output>
