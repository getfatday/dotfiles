---
phase: 02-git-module-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/git/files/.gitconfig
  - modules/git/files/.config/git/ignore
  - modules/git/config.yml
autonomous: false

must_haves:
  truths:
    - ".gitconfig has SSH signing configured with 1Password op-ssh-sign program and placeholder signing key"
    - ".gitconfig default branch is main, not master"
    - ".gitconfig uses Kaleidoscope for diff and merge tool, not kdiff3"
    - ".gitconfig has GitHub credential helper with reset pattern for github.com and gist.github.com"
    - ".gitconfig has rebase.autosquash = true"
    - ".gitconfig excludesfile points to ~/.config/git/ignore"
    - ".gitconfig email is a placeholder with a comment instructing user to update"
    - "Global gitignore exists at modules/git/files/.config/git/ignore with macOS, editor, and Claude entries"
    - "config.yml lists kaleidoscope cask instead of kdiff3"
    - "No corporate config is present (no expedia, azure devops, gcm-core references)"
  artifacts:
    - path: "modules/git/files/.gitconfig"
      provides: "Complete personal git configuration"
      contains: "gpgsign = true"
    - path: "modules/git/files/.config/git/ignore"
      provides: "Global gitignore with macOS/editor/tool patterns"
      contains: ".DS_Store"
    - path: "modules/git/config.yml"
      provides: "Module config with Kaleidoscope cask"
      contains: "kaleidoscope"
  key_links:
    - from: "modules/git/files/.gitconfig"
      to: "modules/git/files/.config/git/ignore"
      via: "core.excludesfile = ~/.config/git/ignore"
      pattern: "excludesfile.*\\.config/git/ignore"
    - from: "modules/git/config.yml"
      to: "Kaleidoscope app"
      via: "homebrew_casks includes kaleidoscope"
      pattern: "kaleidoscope"
---

<objective>
Update the git module with all personal configuration from the old laptop audit: SSH commit signing, Kaleidoscope diff/merge tools, GitHub credential helpers, rebase autosquash, default branch fix, global gitignore, and config.yml cask update.

Purpose: Close all gaps identified in the Phase 1 audit for the git module, making the dotfiles .gitconfig match the old laptop's personal configuration while excluding all corporate artifacts.
Output: Updated .gitconfig, new global gitignore file, updated config.yml
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/audit/GIT.md
@.planning/phases/02-git-module-overhaul/02-RESEARCH.md
@modules/git/files/.gitconfig
@modules/git/config.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update .gitconfig, create global gitignore, update config.yml</name>
  <files>modules/git/files/.gitconfig, modules/git/files/.config/git/ignore, modules/git/config.yml</files>
  <action>
**A) Rewrite `modules/git/files/.gitconfig`** with the following complete configuration. Do NOT keep the old content -- write the full file fresh based on the research template, preserving all existing aliases and settings that are not being replaced:

```ini
[user]
  name = Ian Anderson
  # TODO: Set your personal email (must match GitHub account for commit attribution)
  email = ianderson@example.com
  # TODO: Set your SSH signing key from 1Password (public key, ssh-ed25519 format)
  # See: https://developer.1password.com/docs/ssh/git-commit-signing/
  signingkey = <configure via 1Password>

[core]
  editor = vi
  excludesfile = ~/.config/git/ignore
  autocrlf = input

[gpg]
  format = ssh
[gpg "ssh"]
  program = "/Applications/1Password.app/Contents/MacOS/op-ssh-sign"

[commit]
  gpgsign = true

[color]
  branch = auto
  diff = auto
  interactive = auto
  status = auto

[init]
  defaultBranch = main

[credential]
  helper = osxkeychain
[credential "https://github.com"]
  helper =
  helper = !/opt/homebrew/bin/gh auth git-credential
[credential "https://gist.github.com"]
  helper =
  helper = !/opt/homebrew/bin/gh auth git-credential

[push]
  default = simple

[pull]
  rebase = true

[rebase]
  autosquash = true

[diff]
  tool = Kaleidoscope
[difftool "Kaleidoscope"]
  cmd = ksdiff --partial-changeset --relative-path \"$MERGED\" -- \"$LOCAL\" \"$REMOTE\"
[difftool]
  prompt = false

[merge]
  tool = Kaleidoscope
[mergetool "Kaleidoscope"]
  cmd = ksdiff --merge --output \"$MERGED\" --base \"$BASE\" -- \"$LOCAL\" --snapshot \"$REMOTE\" --snapshot
  trustExitCode = true
[mergetool]
  prompt = false

[alias]
  c = commit
  ca = commit -a
  cm = commit -m
  cam = commit -am
  d = diff
  dc = diff --cached
  l = log --graph --pretty=format:"%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset" --abbrev-commit
  open = "!~/.local/bin/git-open"
  browse = "!~/.local/bin/git-open"

[web]
  browser = google-chrome
```

Key changes from current .gitconfig:
- Added: `[user] signingkey` with placeholder and TODO comment
- Added: `[gpg]`, `[gpg "ssh"]`, `[commit] gpgsign` sections for 1Password SSH signing
- Changed: `core.excludesfile` from `~/.gitignore` to `~/.config/git/ignore` (XDG standard)
- Changed: `init.defaultBranch` from `master` to `main`
- Added: `[credential "https://github.com"]` and `[credential "https://gist.github.com"]` with reset pattern
- Added: `[rebase] autosquash = true`
- Changed: diff/merge tool from kdiff3 to Kaleidoscope with full ksdiff configuration
- Kept: All existing aliases, color settings, push/pull settings, web browser setting
- NOT included: Any corporate config (Azure DevOps, Expedia GitHub, GCM Core, corporate email)
- User email left as `ianderson@example.com` placeholder with TODO comment

**B) Create `modules/git/files/.config/git/ignore`** (new file, create directories as needed):

```
# Global gitignore - user-specific patterns
# Applied via core.excludesfile = ~/.config/git/ignore

# macOS
.DS_Store
.AppleDouble
.LSOverride

# Editor/IDE
.vscode/
.idea/
*.swp
*.swo
*~

# Tools
**/.claude/settings.local.json
```

**C) Update `modules/git/config.yml`**: Replace the `kdiff3` cask with `kaleidoscope`. Remove `google-chrome` from casks (it is not a git dependency -- Chrome should be in its own module or the base module if needed). Fix the duplicate `homebrew_casks` key by combining into a single list.

The updated config.yml should have:
```yaml
homebrew_packages:
  - git
  - git-delta
  - gh
  - git-flow

homebrew_casks:
  - kaleidoscope

stow_dirs:
  - git

mergeable_files:
  - ".zpreztorc"
  - ".zshrc"
```
  </action>
  <verify>
Verify all three files exist and contain expected content:

1. `grep -c "gpgsign = true" modules/git/files/.gitconfig` returns 1
2. `grep -c "defaultBranch = main" modules/git/files/.gitconfig` returns 1
3. `grep -c "Kaleidoscope" modules/git/files/.gitconfig` returns at least 3 (diff tool, difftool section, merge tool, mergetool section)
4. `grep -c "kdiff3" modules/git/files/.gitconfig` returns 0
5. `grep -c "expedia\|azure\|gcm-core" modules/git/files/.gitconfig` returns 0
6. `grep -c "autosquash" modules/git/files/.gitconfig` returns 1
7. `grep -c "gh auth git-credential" modules/git/files/.gitconfig` returns 2
8. `test -f modules/git/files/.config/git/ignore && echo exists` returns "exists"
9. `grep -c "DS_Store" modules/git/files/.config/git/ignore` returns 1
10. `grep -c "kaleidoscope" modules/git/config.yml` returns 1
11. `grep -c "kdiff3" modules/git/config.yml` returns 0
  </verify>
  <done>
- .gitconfig has SSH signing with 1Password op-ssh-sign (placeholder key with TODO comment)
- .gitconfig has Kaleidoscope diff and merge tool configuration
- .gitconfig default branch is main
- .gitconfig has GitHub credential helper with reset pattern for github.com and gist.github.com
- .gitconfig has rebase.autosquash enabled
- .gitconfig excludesfile points to ~/.config/git/ignore
- .gitconfig email is placeholder with TODO comment
- .gitconfig has zero corporate references
- Global gitignore exists at modules/git/files/.config/git/ignore
- config.yml has kaleidoscope cask, no kdiff3
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete git module overhaul: updated .gitconfig with SSH signing, Kaleidoscope, GitHub credential helpers, rebase autosquash, default branch fix; new global gitignore; updated config.yml</what-built>
  <how-to-verify>
    1. Review `modules/git/files/.gitconfig`:
       - Confirm the SSH signing key placeholder and TODO comments are clear
       - Confirm email placeholder is acceptable (or provide your actual personal email)
       - Confirm no corporate artifacts slipped through
       - Confirm Kaleidoscope tool paths look correct
       - Confirm credential helper reset pattern is correct for GitHub
    2. Review `modules/git/files/.config/git/ignore`:
       - Confirm the ignore patterns match your preferences
       - Add any additional patterns you want globally ignored
    3. Review `modules/git/config.yml`:
       - Confirm kaleidoscope cask is desired (replacing kdiff3)
       - Confirm google-chrome removal is acceptable (not a git dependency)
  </how-to-verify>
  <resume-signal>Type "approved" to proceed, or describe any changes needed</resume-signal>
</task>

</tasks>

<verification>
- All 7 items from the git audit "Missing from Dotfiles" section are addressed
- Zero corporate items from the "Corporate Items" section are present
- File structure follows existing module conventions (files/ directory with stow-compatible paths)
- The .config/git/ignore path matches the excludesfile reference in .gitconfig
</verification>

<success_criteria>
- modules/git/files/.gitconfig reflects all personal git config from the audit
- No corporate git config included (no expedia, azure, gcm-core references)
- SSH signing configured with placeholder key and clear setup instructions
- Kaleidoscope configured as diff/merge tool (replacing kdiff3)
- Global gitignore exists with macOS, editor, and Claude patterns
- config.yml updated with kaleidoscope cask
- User has reviewed and approved all changes
</success_criteria>

<output>
After completion, create `.planning/phases/02-git-module-overhaul/02-01-SUMMARY.md`
</output>
