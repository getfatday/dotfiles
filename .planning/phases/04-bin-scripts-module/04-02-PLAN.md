---
phase: 04-bin-scripts-module
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - modules/bin/files/.local/bin/slack-members
  - modules/bin/files/.local/bin/slack-token
  - modules/bin/files/.local/bin/slack-user
  - modules/bin/files/.local/bin/emacs-clean
  - modules/bin/files/.local/bin/emacs-restart
  - modules/bin/files/.local/bin/jsonl2tsv
  - modules/bin/files/.local/bin/git-report
autonomous: false

must_haves:
  truths:
    - "Candidate scripts from old laptop are migrated to modules/bin/files/.local/bin/"
    - "git-report has no corporate references (expediagroup.com line removed/parameterized)"
    - "All migrated scripts use #!/usr/bin/env bash and are committed with mode 100755"
    - "No secrets, corporate domains, or hardcoded user paths in any migrated script"
    - "slack-token dependency for slack-api is now available"
  artifacts:
    - path: "modules/bin/files/.local/bin/slack-token"
      provides: "Slack token reader (dependency for slack-api)"
      contains: "#!/usr/bin/env bash"
    - path: "modules/bin/files/.local/bin/git-report"
      provides: "Git repository reporting tool (sanitized)"
      contains: "#!/usr/bin/env bash"
    - path: "modules/bin/files/.local/bin/jsonl2tsv"
      provides: "JSON Lines to TSV converter"
      contains: "#!/usr/bin/env bash"
  key_links:
    - from: "modules/bin/files/.local/bin/slack-api"
      to: "modules/bin/files/.local/bin/slack-token"
      via: "subshell call $(slack-token)"
      pattern: "slack-token"
    - from: "modules/bin/files/.local/bin/slack-members"
      to: "modules/bin/files/.local/bin/slack-api"
      via: "direct command call"
      pattern: "slack-api"
---

<objective>
Migrate candidate utility scripts from old laptop to modules/bin/, sanitize corporate references, ensure security, fix shebangs and permissions.

Purpose: The audit identified 8 candidate scripts on the old laptop worth migrating. One (jump-window) is a symlink to iCloud tmux config and should be skipped. The remaining 7 are personal utilities: 3 Slack helpers (completing the slack-api ecosystem), 2 Emacs helpers, 1 JSON utility, and 1 git reporting tool that needs corporate line removal.

Output: 7 new scripts migrated, sanitized, and committed with proper shebangs and executable permissions.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/audit/BIN.md
@.planning/phases/04-bin-scripts-module/04-RESEARCH.md
@.planning/phases/04-bin-scripts-module/04-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Mount old laptop volume</name>
  <action>The old laptop volume at `/Volumes/Macintosh HD-1/` is not currently mounted. The candidate scripts live at `/Volumes/Macintosh HD-1/Users/ianderson/bin/`.</action>
  <instructions>
    Connect the old laptop drive (USB/Thunderbolt/Target Disk Mode) so the volume mounts at `/Volumes/Macintosh HD-1/`.

    Alternatively, if the volume cannot be mounted:
    - Type "skip migration" to skip Plan 02 entirely (only the 12 existing scripts from Plan 01 will be in the module)
    - Or provide an alternative path where the old laptop's ~/bin/ contents can be found
  </instructions>
  <resume-signal>Type "mounted" when drive is available, "skip migration" to skip, or provide alternative path</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Copy, sanitize, and commit candidate scripts</name>
  <files>
    modules/bin/files/.local/bin/slack-members
    modules/bin/files/.local/bin/slack-token
    modules/bin/files/.local/bin/slack-user
    modules/bin/files/.local/bin/emacs-clean
    modules/bin/files/.local/bin/emacs-restart
    modules/bin/files/.local/bin/jsonl2tsv
    modules/bin/files/.local/bin/git-report
  </files>
  <action>
    After volume is mounted (or alternative path provided), copy the 7 candidate scripts:

    1. **Copy scripts** from `/Volumes/Macintosh HD-1/Users/ianderson/bin/` (or alternative path) to `modules/bin/files/.local/bin/`:
       - slack-members
       - slack-token
       - slack-user
       - emacs-clean
       - emacs-restart
       - jsonl2tsv
       - git-report

       **DO NOT copy:** jump-window (it's a symlink to iCloud tmux config -- not portable)

    2. **Sanitize each script:**
       - Replace `#!/bin/bash` with `#!/usr/bin/env bash` if needed (shebang must be first line, no blank line before it)
       - For git-report specifically: find the expediagroup.com email fallback (audit says line ~174) and REMOVE or replace with a generic fallback like `git config user.email`. Do NOT leave any @expediagroup.com reference.

    3. **Run security scan on ALL 7 new scripts:**
       ```
       grep -rEi "(expedia|expediagroup|ewegian|hotels\.com|vrbo|zscaler|jamf)" modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       grep -rEi "[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}" modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       grep -rEi "(secret|password|api[_-]?key)" modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       grep -rE "/Users/[^/]+/" modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       grep -rEi "('|\")[a-zA-Z0-9]{24,}('|\")" modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       ```
       If ANY real secrets, corporate references, or actual email addresses are found:
       - Remove or parameterize the offending line
       - Document what was changed
       - Re-run the scan until clean

    4. **Stage with executable permissions:**
       ```
       git add --chmod=+x modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}
       ```

    5. **Verify all files show 100755:**
       ```
       git ls-files -s modules/bin/files/.local/bin/
       ```
       All 19 files (12 existing + 7 new) must show 100755.

    6. **Commit:** `feat(04-02): migrate candidate scripts from old laptop`
  </action>
  <verify>
    Run: `git ls-files -s modules/bin/files/.local/bin/ | wc -l` -- should be 19
    Run: `git ls-files -s modules/bin/files/.local/bin/ | grep 100644` -- should return nothing (all 100755)
    Run: `grep -rEi "expedia" modules/bin/files/.local/bin/` -- should return nothing
    Run: `head -1 modules/bin/files/.local/bin/{slack-members,slack-token,slack-user,emacs-clean,emacs-restart,jsonl2tsv,git-report}` -- all must show `#!/usr/bin/env bash`
  </verify>
  <done>7 candidate scripts migrated, sanitized (no corporate references, no secrets), with portable shebangs and executable permissions. jump-window skipped (symlink, not portable).</done>
</task>

</tasks>

<verification>
- 19 total scripts in modules/bin/files/.local/bin/ (12 existing + 7 migrated)
- All 19 show mode 100755 in git
- All 19 have `#!/usr/bin/env bash` shebang
- Zero grep hits for corporate domains (expedia, hotels.com, vrbo, etc.)
- Zero real email addresses in any script
- Zero hardcoded user paths (/Users/specific-user/)
- slack-token exists, completing the slack-api dependency chain
- git-report has no expediagroup.com reference
</verification>

<success_criteria>
All candidate personal scripts from the old laptop are captured in modules/bin/ with:
1. Portable shebangs
2. Executable permissions (100755)
3. No corporate references (especially expediagroup.com in git-report)
4. No secrets or hardcoded paths
5. jump-window intentionally skipped (symlink to iCloud, not portable)
</success_criteria>

<output>
After completion, create `.planning/phases/04-bin-scripts-module/04-02-SUMMARY.md`
</output>
