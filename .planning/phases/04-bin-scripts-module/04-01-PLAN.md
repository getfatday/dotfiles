---
phase: 04-bin-scripts-module
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/bin/files/.local/bin/git-find-first-term
  - modules/bin/files/.local/bin/git-fixup
  - modules/bin/files/.local/bin/git-last
  - modules/bin/files/.local/bin/git-now
  - modules/bin/files/.local/bin/git-recent
  - modules/bin/files/.local/bin/git-unused
  - modules/bin/files/.local/bin/git-update-author
  - modules/bin/files/.local/bin/preview
  - modules/bin/files/.local/bin/reset-dns
  - modules/bin/files/.local/bin/ripcord
  - modules/bin/files/.local/bin/slack-api
  - modules/bin/files/.local/bin/slack-channels
autonomous: true

must_haves:
  truths:
    - "All 12 existing scripts in modules/bin/files/.local/bin/ are committed with git mode 100755 (executable)"
    - "All scripts use portable #!/usr/bin/env bash shebang as the first line"
    - "No corporate references, secrets, or hardcoded user paths exist in any script"
  artifacts:
    - path: "modules/bin/files/.local/bin/git-find-first-term"
      provides: "Git commit search by term"
      contains: "#!/usr/bin/env bash"
    - path: "modules/bin/files/.local/bin/slack-api"
      provides: "Slack API wrapper"
      contains: "#!/usr/bin/env bash"
  key_links:
    - from: "modules/bin/files/.local/bin/slack-api"
      to: "slack-token"
      via: "subshell call $(slack-token)"
      pattern: "slack-token"
    - from: "modules/bin/files/.local/bin/slack-channels"
      to: "slack-api"
      via: "direct command call"
      pattern: "slack-api"
---

<objective>
Fix all 12 existing scripts in modules/bin/files/.local/bin/ to have portable shebangs and executable git permissions.

Purpose: The existing scripts were committed with mode 644 (non-executable) and 10 of 12 use hardcoded `#!/bin/bash` shebangs. After GNU Stow deploys these via symlinks, they won't be executable. This plan fixes both issues so scripts work correctly after stowing.

Output: All 12 scripts with `#!/usr/bin/env bash` shebangs and git mode 100755.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-bin-scripts-module/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update shebangs to portable format</name>
  <files>
    modules/bin/files/.local/bin/git-find-first-term
    modules/bin/files/.local/bin/git-fixup
    modules/bin/files/.local/bin/git-last
    modules/bin/files/.local/bin/git-now
    modules/bin/files/.local/bin/git-update-author
    modules/bin/files/.local/bin/preview
    modules/bin/files/.local/bin/reset-dns
    modules/bin/files/.local/bin/ripcord
    modules/bin/files/.local/bin/slack-api
    modules/bin/files/.local/bin/slack-channels
  </files>
  <action>
    Replace `#!/bin/bash` with `#!/usr/bin/env bash` in these 10 scripts (git-recent and git-unused already have the correct shebang). Read each file, change only the first line from `#!/bin/bash` to `#!/usr/bin/env bash`, write it back. Do NOT change anything else in the files.

    Scripts that already have `#!/usr/bin/env bash` (leave alone): git-recent, git-unused.
  </action>
  <verify>
    Run: `head -1 modules/bin/files/.local/bin/*`
    All 12 scripts must show `#!/usr/bin/env bash` as the first line.
  </verify>
  <done>All 12 scripts have `#!/usr/bin/env bash` as their first line, no other content changed.</done>
</task>

<task type="auto">
  <name>Task 2: Set executable permissions and run security scan</name>
  <files>
    modules/bin/files/.local/bin/git-find-first-term
    modules/bin/files/.local/bin/git-fixup
    modules/bin/files/.local/bin/git-last
    modules/bin/files/.local/bin/git-now
    modules/bin/files/.local/bin/git-recent
    modules/bin/files/.local/bin/git-unused
    modules/bin/files/.local/bin/git-update-author
    modules/bin/files/.local/bin/preview
    modules/bin/files/.local/bin/reset-dns
    modules/bin/files/.local/bin/ripcord
    modules/bin/files/.local/bin/slack-api
    modules/bin/files/.local/bin/slack-channels
  </files>
  <action>
    1. Stage all 12 scripts with executable permissions using `git add --chmod=+x` for each file in modules/bin/files/.local/bin/.

    2. Run a security scan on all 12 scripts before committing:
       - Check for email addresses: `grep -rEi "[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}" modules/bin/files/.local/bin/`
       - Check for corporate references: `grep -rEi "(expedia|expediagroup|ewegian|hotels\.com|vrbo|zscaler|jamf)" modules/bin/files/.local/bin/`
       - Check for secret patterns: `grep -rEi "(secret|password|api[_-]?key)" modules/bin/files/.local/bin/`
       - Check for hardcoded user paths: `grep -rE "/Users/[^/]+/" modules/bin/files/.local/bin/`

       NOTE on expected findings:
       - git-update-author has `me@gmail.com` and `me@example.com` in usage COMMENTS only -- these are placeholder examples, not real emails. This is SAFE.
       - slack-api uses `slack-token` command (not a hardcoded token). This is SAFE.
       - If any REAL secrets, corporate references, or actual email addresses are found, flag them and do NOT commit.

    3. Verify staged permissions: `git ls-files -s modules/bin/files/.local/bin/` -- all must show 100755.

    4. Commit with message: `feat(04-01): fix shebangs and permissions for existing bin scripts`
  </action>
  <verify>
    Run: `git ls-files -s modules/bin/files/.local/bin/`
    All 12 files must show mode 100755.
    Run: `git log --oneline -1`
    Must show the commit message.
  </verify>
  <done>All 12 scripts are committed with mode 100755 and no security issues found.</done>
</task>

</tasks>

<verification>
- `git ls-files -s modules/bin/files/.local/bin/` shows all 12 files with mode 100755
- `head -1 modules/bin/files/.local/bin/*` shows `#!/usr/bin/env bash` for all 12 scripts
- No corporate references, real email addresses, or secrets in any script
- Security scan passes clean (only placeholder examples in comments)
</verification>

<success_criteria>
All 12 existing scripts in modules/bin/ are committed to git with:
1. Portable `#!/usr/bin/env bash` shebangs
2. Executable mode 100755
3. Clean security scan (no secrets, no corporate references)
</success_criteria>

<output>
After completion, create `.planning/phases/04-bin-scripts-module/04-01-SUMMARY.md`
</output>
