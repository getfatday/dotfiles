---
phase: 03-shell-module-update
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/zsh/files/.zshrc
  - modules/zsh/files/.zpreztorc
  - modules/zsh/config.yml
  - modules/git/files/.zpreztorc
  - modules/git/files/.zshenv
  - modules/git/config.yml

autonomous: true

must_haves:
  truths:
    - "Prezto framework initializes when an interactive shell starts"
    - "Prezto git aliases (gws, gwd, etc.) are available in shell"
    - "Git module contributes $HOME/bin to PATH via .zshenv"
    - "Zsh module declares .zshenv as a mergeable file"
  artifacts:
    - path: "modules/zsh/files/.zshrc"
      provides: "Prezto initialization source line"
      contains: "source.*zprezto/init.zsh"
    - path: "modules/zsh/files/.zpreztorc"
      provides: "Prezto git alias skip set to no"
      contains: "git:alias.*skip.*no"
    - path: "modules/zsh/config.yml"
      provides: ".zshenv declared as mergeable"
      contains: ".zshenv"
    - path: "modules/git/files/.zpreztorc"
      provides: "Git module Prezto alias skip set to no"
      contains: "git:alias.*skip.*no"
    - path: "modules/git/files/.zshenv"
      provides: "$HOME/bin in PATH"
      contains: "HOME/bin"
    - path: "modules/git/config.yml"
      provides: ".zshenv declared as mergeable"
      contains: ".zshenv"
  key_links:
    - from: "modules/zsh/files/.zshrc"
      to: "~/.zprezto/init.zsh"
      via: "conditional source"
      pattern: "source.*zprezto/init.zsh"
    - from: "modules/git/files/.zpreztorc"
      to: "Prezto git module"
      via: "zstyle alias skip"
      pattern: "git:alias.*skip.*no"
---

<objective>
Fix Prezto framework initialization and enable git aliases across zsh and git modules.

Purpose: The Prezto framework is configured (.zpreztorc exists) but never initialized (.zshrc lacks the source line), meaning syntax highlighting, git prompt, and all Prezto modules silently fail to load. The git module also disables Prezto's curated git aliases despite the old laptop having them enabled. This plan fixes both critical gaps and adds the missing .zshenv for the git module's PATH contribution.

Output: Working Prezto initialization in zsh module, enabled git aliases in both zsh and git module .zpreztorc files, git module .zshenv with $HOME/bin PATH entry, and .zshenv declared as mergeable in both modules.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-shell-module-update/03-RESEARCH.md
@modules/zsh/files/.zshrc
@modules/zsh/files/.zpreztorc
@modules/zsh/config.yml
@modules/git/files/.zpreztorc
@modules/git/config.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Prezto init to zsh .zshrc and update .zpreztorc + config.yml</name>
  <files>
    modules/zsh/files/.zshrc
    modules/zsh/files/.zpreztorc
    modules/zsh/config.yml
  </files>
  <action>
1. **modules/zsh/files/.zshrc** — The current file has productivity content (autojump, z, aliases, redact function) that actually belongs to the productivity module (which already has its own .zshrc at modules/productivity/files/.zshrc with identical content). Replace the entire content with the zsh module's own responsibility: Prezto initialization. The new .zshrc should contain:

```bash
# Zsh module contribution to Zsh configuration
# This file will be merged with the main .zshrc file

# Source Prezto framework
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi
```

IMPORTANT: The current content is a duplicate of modules/productivity/files/.zshrc. Do NOT preserve it here — the productivity module already owns that content. The merged .zshrc will include both modules' contributions at deploy time.

2. **modules/zsh/files/.zpreztorc** — Update the git alias configuration. Find the line:
```
zstyle ':prezto:module:git:status:ignore' submodules 'all'
```
Add after it (before the `# Prompt` section):
```
zstyle ':prezto:module:git:alias' skip 'no'
```
This enables Prezto's built-in git aliases (gws, gwd, gws, etc.) which were active on the old laptop.

3. **modules/zsh/config.yml** — Add `.zshenv` to the `mergeable_files` list so modules can contribute environment variables. The list should become:
```yaml
mergeable_files:
  - ".zshrc"
  - ".zshenv"
  - ".zpreztorc"
```
  </action>
  <verify>
- `grep -q "zprezto/init.zsh" modules/zsh/files/.zshrc` succeeds
- `grep -q "autojump" modules/zsh/files/.zshrc` fails (productivity content removed)
- `grep -q "git:alias.*skip.*no" modules/zsh/files/.zpreztorc` succeeds
- `grep -q ".zshenv" modules/zsh/config.yml` succeeds
  </verify>
  <done>
- Zsh module .zshrc sources Prezto init and contains only core zsh config (no productivity duplicates)
- Zsh module .zpreztorc enables Prezto git aliases with skip 'no'
- Zsh module config.yml declares .zshenv as mergeable
  </done>
</task>

<task type="auto">
  <name>Task 2: Update git module .zpreztorc alias skip and add .zshenv with PATH</name>
  <files>
    modules/git/files/.zpreztorc
    modules/git/files/.zshenv
    modules/git/config.yml
  </files>
  <action>
1. **modules/git/files/.zpreztorc** — Change `skip 'yes'` to `skip 'no'` on the git alias line:
```
zstyle ':prezto:module:git:alias' skip 'no'
```
This aligns with the old laptop's configuration and enables Prezto's curated git aliases (gws for `git status`, gwd for `git diff`, etc.) alongside the custom aliases already defined in modules/git/files/.zshrc.

2. **modules/git/files/.zshenv** — Create this new file with the git module's PATH contribution:
```bash
# Git module contribution to Zsh environment
# This file will be merged with the main .zshenv file

# Add ~/bin to PATH for git helper scripts
export PATH="$HOME/bin:$PATH"
```
This matches the old laptop's .zshenv which had `$HOME/bin` in PATH, contributed by the git module. The git module stows scripts to ~/.local/bin (git-open, git-fixup, etc.) but the old laptop also used ~/bin for additional scripts.

3. **modules/git/config.yml** — Add `.zshenv` to the existing `mergeable_files` list. The list should become:
```yaml
mergeable_files:
  - ".zpreztorc"
  - ".zshrc"
  - ".zshenv"
```
  </action>
  <verify>
- `grep -q "skip 'no'" modules/git/files/.zpreztorc` succeeds
- `grep -q "skip 'yes'" modules/git/files/.zpreztorc` fails
- `test -f modules/git/files/.zshenv` succeeds
- `grep -q "HOME/bin" modules/git/files/.zshenv` succeeds
- `grep -q ".zshenv" modules/git/config.yml` succeeds
  </verify>
  <done>
- Git module .zpreztorc enables Prezto git aliases (skip 'no')
- Git module .zshenv adds $HOME/bin to PATH
- Git module config.yml declares .zshenv as mergeable
  </done>
</task>

</tasks>

<verification>
Run these checks after both tasks complete:

```bash
# Prezto init is sourced in zsh module
grep "zprezto/init.zsh" modules/zsh/files/.zshrc

# No productivity content leaked into zsh module
! grep -q "autojump\|redact\|caffeinate" modules/zsh/files/.zshrc

# Git aliases enabled in both .zpreztorc files
grep "skip 'no'" modules/zsh/files/.zpreztorc modules/git/files/.zpreztorc

# No remaining skip 'yes' anywhere
! grep -rq "skip 'yes'" modules/

# .zshenv exists for git module
test -f modules/git/files/.zshenv

# .zshenv declared mergeable in zsh and git config.yml
grep ".zshenv" modules/zsh/config.yml modules/git/config.yml
```
</verification>

<success_criteria>
1. `modules/zsh/files/.zshrc` contains Prezto init source line and no duplicated productivity content
2. Both `modules/zsh/files/.zpreztorc` and `modules/git/files/.zpreztorc` have `git:alias skip 'no'`
3. `modules/git/files/.zshenv` exists with `$HOME/bin` in PATH
4. Both `modules/zsh/config.yml` and `modules/git/config.yml` declare `.zshenv` as mergeable
</success_criteria>

<output>
After completion, create `.planning/phases/03-shell-module-update/03-01-SUMMARY.md`
</output>
