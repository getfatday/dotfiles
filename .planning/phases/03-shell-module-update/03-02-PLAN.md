---
phase: 03-shell-module-update
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/node/files/.zshrc
  - modules/node/files/.tool-versions
  - modules/speckit/files/.zshenv
  - modules/speckit/config.yml
  - modules/claude/files/.zshrc
  - modules/claude/config.yml

autonomous: true

must_haves:
  truths:
    - "Node module uses architecture-safe Homebrew paths (no hardcoded /opt/homebrew)"
    - "Global .tool-versions reflects current tool versions"
    - "Speckit module contributes $HOME/.local/bin to PATH via .zshenv"
    - "Claude yolo alias is available in shell"
  artifacts:
    - path: "modules/node/files/.zshrc"
      provides: "Cross-architecture asdf integration"
      contains: "brew --prefix"
    - path: "modules/node/files/.tool-versions"
      provides: "Global tool version defaults"
      contains: "nodejs"
    - path: "modules/speckit/files/.zshenv"
      provides: "$HOME/.local/bin in PATH"
      contains: "HOME/.local/bin"
    - path: "modules/speckit/config.yml"
      provides: ".zshenv declared as mergeable"
      contains: ".zshenv"
    - path: "modules/claude/files/.zshrc"
      provides: "yolo alias for Claude"
      contains: "alias yolo"
    - path: "modules/claude/config.yml"
      provides: ".zshrc declared as mergeable"
      contains: ".zshrc"
  key_links:
    - from: "modules/node/files/.zshrc"
      to: "asdf"
      via: "brew --prefix sourcing"
      pattern: "brew --prefix.*asdf"
    - from: "modules/speckit/config.yml"
      to: "modules/speckit/files/.zshenv"
      via: "mergeable_files declaration"
      pattern: ".zshenv"
    - from: "modules/claude/config.yml"
      to: "modules/claude/files/.zshrc"
      via: "mergeable_files declaration"
      pattern: ".zshrc"
---

<objective>
Fix cross-architecture Homebrew paths in node module, add missing .zshenv for speckit, and add Claude yolo alias.

Purpose: The node module hardcodes `/opt/homebrew` paths that break on Intel Macs. The speckit module needs `$HOME/.local/bin` in PATH (per the old laptop audit) but lacks a .zshenv. The claude module has no shell integration despite the old laptop having a `yolo` alias. This plan fixes all three module-specific shell configuration gaps.

Output: Architecture-safe node module, speckit .zshenv with PATH entry, claude .zshrc with yolo alias, and updated config.yml files declaring mergeable shell files.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-shell-module-update/03-RESEARCH.md
@modules/node/files/.zshrc
@modules/node/files/.zshenv
@modules/node/files/.tool-versions
@modules/speckit/config.yml
@modules/claude/config.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix node module cross-architecture paths and update .tool-versions</name>
  <files>
    modules/node/files/.zshrc
    modules/node/files/.tool-versions
  </files>
  <action>
1. **modules/node/files/.zshrc** — Replace hardcoded `/opt/homebrew` paths with architecture-safe alternatives. The current file has two issues:
   - Line 6: `export PATH="/opt/homebrew/bin:...` hardcodes ARM Homebrew path
   - Line 9: `if [ -f /opt/homebrew/opt/asdf/libexec/asdf.sh ]` hardcodes ARM asdf path

   Replace the entire file with:

```bash
# Node module contribution to Zsh configuration
# This file will be merged with the main .zshrc file

# pnpm configuration
export PNPM_HOME="$HOME/Library/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac

# ASDF integration (cross-architecture)
if command -v brew >/dev/null 2>&1; then
  _asdf_sh="$(brew --prefix)/opt/asdf/libexec/asdf.sh"
  if [[ -f "$_asdf_sh" ]]; then
    . "$_asdf_sh"
  fi
  unset _asdf_sh
fi

# ASDF direnv integration
if [[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/asdf-direnv/zshrc" ]]; then
  source "${XDG_CONFIG_HOME:-$HOME/.config}/asdf-direnv/zshrc"
fi
```

Key changes:
- PNPM_HOME uses `$HOME` instead of hardcoded `/Users/ianderson`
- PNPM PATH addition uses the standard idempotent `case` guard pattern
- Removed hardcoded `/opt/homebrew/bin` and `python3 -m site --user-base` from PATH (those belong in their respective modules or aren't needed)
- ASDF sourcing uses `brew --prefix` instead of hardcoded `/opt/homebrew`

2. **modules/node/files/.tool-versions** — Update to reflect current tool versions from the old laptop audit. Replace content with:

```
nodejs 25.2.1
jq 1.7.1
```

Remove the comment header (asdf doesn't use comments in .tool-versions; lines starting with `#` are not standard). The old laptop had `nodejs 25.2.1` and `jq 1.7.1` as global defaults.
  </action>
  <verify>
- `! grep -q "/opt/homebrew" modules/node/files/.zshrc` (no hardcoded ARM paths)
- `! grep -q "/Users/ianderson" modules/node/files/.zshrc` (no hardcoded username)
- `grep -q "brew --prefix" modules/node/files/.zshrc` (uses dynamic prefix)
- `grep -q "PNPM_HOME" modules/node/files/.zshrc` (pnpm still configured)
- `grep -q "25.2.1" modules/node/files/.tool-versions` (updated node version)
- `grep -q "jq" modules/node/files/.tool-versions` (jq added)
  </verify>
  <done>
- Node module .zshrc uses `brew --prefix` for all Homebrew paths
- No hardcoded usernames or architecture-specific paths remain
- PNPM configuration uses portable `$HOME` reference
- .tool-versions reflects current global tool defaults (nodejs 25.2.1, jq 1.7.1)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add speckit .zshenv and claude .zshrc with yolo alias</name>
  <files>
    modules/speckit/files/.zshenv
    modules/speckit/config.yml
    modules/claude/files/.zshrc
    modules/claude/config.yml
  </files>
  <action>
1. **modules/speckit/files/.zshenv** — Create this new file. The speckit module installs tools to `$HOME/.local/bin` (via uv) but doesn't add it to PATH. The old laptop audit shows this was in .zshenv. Content:

```bash
# Speckit module contribution to Zsh environment
# This file will be merged with the main .zshenv file

# Add ~/.local/bin to PATH for uv-installed tools (spec-kit, etc.)
export PATH="$HOME/.local/bin:$PATH"
```

2. **modules/speckit/config.yml** — Add `stow_dirs` and `mergeable_files` sections. The current config only has `homebrew_packages: [uv]`. Add:

```yaml
stow_dirs:
  - speckit

mergeable_files:
  - ".zshenv"
```

Place these after the `homebrew_packages` block and before the `# Note:` comment block.

3. **modules/claude/files/.zshrc** — Create this new file with the Claude alias from the old laptop:

```bash
# Claude module contribution to Zsh configuration
# This file will be merged with the main .zshrc file

# Claude Code aliases
alias yolo='claude --dangerously-skip-permissions'
```

4. **modules/claude/config.yml** — Add `mergeable_files` section. The current config has `homebrew_casks: [claude]` and `stow_dirs: [claude]`. Add after `stow_dirs`:

```yaml
mergeable_files:
  - ".zshrc"
```
  </action>
  <verify>
- `test -f modules/speckit/files/.zshenv` succeeds
- `grep -q "HOME/.local/bin" modules/speckit/files/.zshenv` succeeds
- `grep -q "mergeable_files" modules/speckit/config.yml` succeeds
- `grep -q ".zshenv" modules/speckit/config.yml` succeeds
- `test -f modules/claude/files/.zshrc` succeeds
- `grep -q "alias yolo" modules/claude/files/.zshrc` succeeds
- `grep -q "mergeable_files" modules/claude/config.yml` succeeds
- `grep -q ".zshrc" modules/claude/config.yml` succeeds
  </verify>
  <done>
- Speckit module has .zshenv adding $HOME/.local/bin to PATH
- Speckit config.yml declares .zshenv as mergeable with stow_dirs
- Claude module has .zshrc with yolo alias
- Claude config.yml declares .zshrc as mergeable
  </done>
</task>

</tasks>

<verification>
Run these checks after both tasks complete:

```bash
# No hardcoded architecture paths in node module
! grep -rq "/opt/homebrew" modules/node/files/.zshrc
! grep -rq "/Users/ianderson" modules/node/files/.zshrc

# Cross-arch pattern used
grep "brew --prefix" modules/node/files/.zshrc

# Tool versions updated
grep "25.2.1" modules/node/files/.tool-versions
grep "jq" modules/node/files/.tool-versions

# Speckit .zshenv exists and is declared
test -f modules/speckit/files/.zshenv
grep ".zshenv" modules/speckit/config.yml

# Claude .zshrc exists and is declared
test -f modules/claude/files/.zshrc
grep "yolo" modules/claude/files/.zshrc
grep ".zshrc" modules/claude/config.yml

# No corporate config leaked in
! grep -riq "expedia\|ewegian\|zscaler\|android.ndk" modules/node/ modules/speckit/ modules/claude/
```
</verification>

<success_criteria>
1. `modules/node/files/.zshrc` contains no hardcoded `/opt/homebrew` or `/Users/ianderson` paths
2. `modules/node/files/.zshrc` uses `brew --prefix` for Homebrew path detection
3. `modules/node/files/.tool-versions` has `nodejs 25.2.1` and `jq 1.7.1`
4. `modules/speckit/files/.zshenv` exists with `$HOME/.local/bin` in PATH
5. `modules/speckit/config.yml` has `mergeable_files` with `.zshenv` and `stow_dirs` with `speckit`
6. `modules/claude/files/.zshrc` exists with `yolo` alias
7. `modules/claude/config.yml` has `mergeable_files` with `.zshrc`
</success_criteria>

<output>
After completion, create `.planning/phases/03-shell-module-update/03-02-SUMMARY.md`
</output>
