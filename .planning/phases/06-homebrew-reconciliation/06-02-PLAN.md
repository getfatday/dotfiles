---
phase: 06-homebrew-reconciliation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/firefox/config.yml
  - modules/ngrok/config.yml
  - modules/vscode/config.yml
  - modules/sequel-ace/config.yml
  - modules/flux/config.yml
  - modules/bartender/config.yml
  - modules/dropbox/config.yml
  - modules/licecap/config.yml
  - modules/karabiner/config.yml
autonomous: true

must_haves:
  truths:
    - "All personal casks from audit are declared in module configs"
    - "No corporate or obsolete casks are declared"
    - "Each cask-only app has its own module following existing pattern"
  artifacts:
    - path: "modules/firefox/config.yml"
      provides: "Firefox browser cask"
      contains: "firefox"
    - path: "modules/ngrok/config.yml"
      provides: "ngrok tunneling cask"
      contains: "ngrok"
    - path: "modules/vscode/config.yml"
      provides: "VS Code editor cask"
      contains: "visual-studio-code"
    - path: "modules/sequel-ace/config.yml"
      provides: "Sequel Ace database GUI"
      contains: "sequel-ace"
    - path: "modules/flux/config.yml"
      provides: "f.lux blue light filter"
      contains: "flux"
    - path: "modules/bartender/config.yml"
      provides: "Bartender menu bar manager"
      contains: "bartender"
    - path: "modules/dropbox/config.yml"
      provides: "Dropbox cloud storage"
      contains: "dropbox"
    - path: "modules/licecap/config.yml"
      provides: "LICEcap screen recording"
      contains: "licecap"
    - path: "modules/karabiner/config.yml"
      provides: "Karabiner-Elements keyboard customizer"
      contains: "karabiner-elements"
  key_links: []
---

<objective>
Create cask-only modules for personal GUI applications identified in the Homebrew audit but not yet declared in module configs.

Purpose: Ensure all personal macOS GUI applications are captured in the modular config system, enabling reproducible installs on new machines.
Output: 9 new cask-only module config.yml files.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/audit/HOMEBREW.md
@.planning/phases/06-homebrew-reconciliation/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cask-only modules for personal GUI apps</name>
  <files>
    modules/firefox/config.yml
    modules/ngrok/config.yml
    modules/vscode/config.yml
    modules/sequel-ace/config.yml
    modules/flux/config.yml
    modules/bartender/config.yml
    modules/dropbox/config.yml
    modules/licecap/config.yml
    modules/karabiner/config.yml
  </files>
  <action>
Create nine new cask-only module directories with config.yml files. Follow the existing cask-only module pattern (see modules/handbrake/config.yml, modules/spotify/config.yml, or modules/chrome/config.yml for reference).

Each module config.yml must follow this exact pattern:
```yaml
---
# [Module name] module
# [Brief description]

# [App name] from Homebrew Cask
homebrew_casks:
  - [cask-name]

# Note: This module provides:
# - [Brief description of what app does]
```

**Create these 9 modules:**

1. **modules/firefox/config.yml** — cask: `firefox` — "Mozilla Firefox web browser"
2. **modules/ngrok/config.yml** — cask: `ngrok` — "Secure tunneling to localhost for development and webhooks"
3. **modules/vscode/config.yml** — cask: `visual-studio-code` — "Microsoft Visual Studio Code editor"
4. **modules/sequel-ace/config.yml** — cask: `sequel-ace` — "MySQL/MariaDB database management GUI (successor to Sequel Pro)"
5. **modules/flux/config.yml** — cask: `flux` — "f.lux blue light filter for reducing eye strain"
6. **modules/bartender/config.yml** — cask: `bartender` — "Menu bar icon manager and organizer"
7. **modules/dropbox/config.yml** — cask: `dropbox` — "Dropbox cloud file storage and sync"
8. **modules/licecap/config.yml** — cask: `licecap` — "Animated GIF screen capture tool"
9. **modules/karabiner/config.yml** — cask: `karabiner-elements` — "Keyboard customization utility for macOS (key remapping, complex modifications)"

**Do NOT create modules for these excluded casks (from audit):**
- android-commandlinetools, android-ndk, android-platform-tools (corporate)
- autodesk-fusion/fusion360 (specialized, install on demand)
- chatgpt-atlas (old name, chatgpt module already exists)
- chromedriver (testing tool, install on demand)
- git-credential-manager (replaced by gh auth)
- marked/marked-app, macdown (markdown editors, install on demand)
- neo4j/neo4j-desktop (specialized, install on demand)
- sublime-text (replaced by Cursor/VS Code)
- expo-orbit (corporate)
- 1password-cli (handled by 1password module)

**Formatting requirements:**
- Start each file with `---` YAML document separator
- Use consistent comment style matching existing cask modules
- Cask name must be the exact Homebrew cask token (e.g., `visual-studio-code` not `vscode`)
  </action>
  <verify>
Run: `ls modules/firefox/config.yml modules/ngrok/config.yml modules/vscode/config.yml modules/sequel-ace/config.yml modules/flux/config.yml modules/bartender/config.yml modules/dropbox/config.yml modules/licecap/config.yml modules/karabiner/config.yml` — all 9 files exist
Run: `grep "homebrew_casks" modules/firefox/config.yml modules/ngrok/config.yml modules/vscode/config.yml modules/sequel-ace/config.yml modules/flux/config.yml modules/bartender/config.yml modules/dropbox/config.yml modules/licecap/config.yml modules/karabiner/config.yml` — all 9 have homebrew_casks
Verify no duplicate casks: `grep -rh "homebrew_casks" -A 10 modules/*/config.yml | grep "^  - " | sed 's/^  - //' | sort | uniq -d` — expect empty
  </verify>
  <done>
All 9 cask-only modules exist with properly formatted config.yml files matching the existing project pattern. No corporate or deprecated casks included. No duplicate cask declarations across modules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate complete Homebrew reconciliation</name>
  <files>
    (no files modified — validation only)
  </files>
  <action>
Run validation to confirm all personal packages from the audit are now declared in module configs and no corporate packages slipped in.

**Step 1: Extract all declared formulas from modules**
```bash
grep -rh "^  - " modules/*/config.yml | sed 's/^  - //' | sed 's/ *#.*//' | sort -u
```

**Step 2: Cross-reference with audit "worth adding" list**
Verify every formula from the audit's "Formulae worth adding" section appears in exactly one module:
- ansible (SKIP — not in audit's "worth adding" list, was in brew leaves but not flagged)
- ffmpeg, go, imagemagick, jq, nginx, postgresql@14, stow, tmux, wget ✓
- gnupg, pinentry-mac, sops ✓
- streamlink, rename, rsync, dos2unix ✓
- git-filter-repo, git-quick-stats ✓
- things.sh, ical-buddy ✓
- obsidian-cli ✓
- reattach-to-user-namespace, gnu-sed ✓

**Step 3: Cross-reference with audit "Casks worth adding" list**
Verify every cask from the audit appears in exactly one module:
- karabiner-elements, firefox, ngrok, visual-studio-code ✓
- sequel-ace, flux, bartender, dropbox, licecap ✓

**Step 4: Verify no corporate packages**
```bash
grep -rh "^  - " modules/*/config.yml | grep -iE "aws|azure|cfn|egctl|helm|teleport|vault|saml|terraform|mongocli|mongosh|android|zscaler|jamf"
```
Must return empty.

**Step 5: Verify no duplicate packages**
```bash
grep -rh "^  - " modules/*/config.yml | sed 's/^  - //' | sed 's/ *#.*//' | sort | uniq -d
```
Must return empty.

**Step 6: Count totals and report**
Report: total formulas declared, total casks declared, new formulas added, new casks added, new modules created.
  </action>
  <verify>
All audit "worth adding" formulas appear in module configs.
All audit "worth adding" casks appear in module configs.
No corporate packages in any module config.
No duplicate packages across modules.
  </verify>
  <done>
Validation confirms 100% coverage of personal packages from audit. Zero corporate packages. Zero duplicates. Reconciliation is complete.
  </done>
</task>

</tasks>

<verification>
1. All 9 cask-only modules follow existing project pattern (compare with modules/handbrake/config.yml)
2. Every cask from audit "Casks worth adding" is declared in exactly one module
3. No excluded/corporate casks appear in any module
4. Combined with Plan 01, all audit items are accounted for (declared, excluded, or skipped with rationale)
5. No duplicate package declarations exist across any module configs
</verification>

<success_criteria>
- 9 new cask-only modules created matching existing project patterns
- Validation confirms all audit items resolved (declared or explicitly excluded)
- Zero corporate packages in any module config
- Zero duplicate declarations across all modules
</success_criteria>

<output>
After completion, create `.planning/phases/06-homebrew-reconciliation/06-02-SUMMARY.md`
</output>
