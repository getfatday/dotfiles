---
phase: 06-homebrew-reconciliation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/productivity/config.yml
  - modules/git/config.yml
  - modules/obsidian/config.yml
  - modules/macos/config.yml
  - modules/media/config.yml
  - modules/tmux/config.yml
  - modules/go/config.yml
  - modules/security/config.yml
  - modules/database/config.yml
autonomous: true

must_haves:
  truths:
    - "All personal formulas from brew leaves are declared in module configs"
    - "No corporate or deprecated packages are declared"
    - "Each formula is in the most logical module for its purpose"
    - "Third-party taps are declared alongside their packages"
  artifacts:
    - path: "modules/productivity/config.yml"
      provides: "CLI utility formulas"
      contains: "jq"
    - path: "modules/git/config.yml"
      provides: "Git ecosystem formulas"
      contains: "git-filter-repo"
    - path: "modules/obsidian/config.yml"
      provides: "Obsidian CLI tool with tap"
      contains: "obsidian-cli"
    - path: "modules/macos/config.yml"
      provides: "macOS-specific CLI tools"
      contains: "ical-buddy"
    - path: "modules/media/config.yml"
      provides: "Media processing tools"
      contains: "ffmpeg"
    - path: "modules/tmux/config.yml"
      provides: "Terminal multiplexer"
      contains: "tmux"
    - path: "modules/go/config.yml"
      provides: "Go language"
      contains: "go"
    - path: "modules/security/config.yml"
      provides: "GPG and encryption tools"
      contains: "gnupg"
    - path: "modules/database/config.yml"
      provides: "Database server tools"
      contains: "postgresql@14"
  key_links:
    - from: "modules/obsidian/config.yml"
      to: "yakitrak/yakitrak tap"
      via: "homebrew_taps declaration"
      pattern: "yakitrak/yakitrak"
---

<objective>
Add all missing personal Homebrew formulas to appropriate module config.yml files. Update existing modules with undeclared formulas and create new modules for logical formula groupings that don't fit existing modules.

Purpose: Close the gap between installed personal formulas (from brew leaves audit) and module declarations, ensuring a fresh machine install reproduces the desired package set.
Output: Updated config.yml files for 4 existing modules + 5 new module config.yml files.
</objective>

<execution_context>
@/Users/ianderson/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianderson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/audit/HOMEBREW.md
@.planning/phases/06-homebrew-reconciliation/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing formulas to existing modules</name>
  <files>
    modules/productivity/config.yml
    modules/git/config.yml
    modules/obsidian/config.yml
    modules/macos/config.yml
  </files>
  <action>
Update four existing module config.yml files to declare missing personal formulas.

**modules/productivity/config.yml** — Add to `homebrew_packages`:
- `jq` — JSON processor
- `wget` — HTTP fetcher
- `rsync` — file sync (newer than macOS built-in)
- `dos2unix` — line ending conversion
- `rename` — batch file rename (Perl rename utility)
- `gnu-sed` — GNU sed (macOS sed is BSD, limited)
- `stow` — GNU Stow (used by the dotfiles system itself)
- `nginx` — web server (local development)

Keep existing packages (autojump, z, fzf) and all other config unchanged.

**modules/git/config.yml** — Add to `homebrew_packages`:
- `git-filter-repo` — git history rewriting tool (replacement for filter-branch)
- `git-quick-stats` — git repository statistics

Keep existing packages (git, git-delta, gh, git-flow) and all other config unchanged.

**modules/obsidian/config.yml** — Add `homebrew_taps` and `homebrew_packages` sections:
- Add `homebrew_taps: ["yakitrak/yakitrak"]`
- Add `homebrew_packages: ["obsidian-cli"]`
- Keep existing `homebrew_casks` and all other config unchanged

**modules/macos/config.yml** — Add to `homebrew_packages`:
- `ical-buddy` — calendar CLI (reads macOS Calendar)
- `things.sh` — Things 3 CLI interface

Keep existing packages (mas) and all other config unchanged.

**Format rules:**
- Follow existing YAML style in each file (some use `---` header with comments, some don't)
- Add brief inline comments explaining each new package (e.g., `- jq  # JSON processor`)
- Maintain alphabetical order within homebrew_packages lists where the existing file uses it
  </action>
  <verify>
Run: `grep -c "jq\|wget\|rsync\|dos2unix\|rename\|gnu-sed\|stow\|nginx" modules/productivity/config.yml` — expect 8
Run: `grep -c "git-filter-repo\|git-quick-stats" modules/git/config.yml` — expect 2
Run: `grep -c "obsidian-cli\|yakitrak" modules/obsidian/config.yml` — expect at least 2
Run: `grep -c "ical-buddy\|things.sh" modules/macos/config.yml` — expect 2
  </verify>
  <done>
All four existing module config.yml files contain the new formula declarations with proper inline comments. No existing declarations removed. No corporate packages added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create new modules for formula groupings</name>
  <files>
    modules/media/config.yml
    modules/tmux/config.yml
    modules/go/config.yml
    modules/security/config.yml
    modules/database/config.yml
  </files>
  <action>
Create five new module directories with config.yml files. Follow the existing module config.yml pattern (see modules/rust/config.yml or modules/docker/config.yml for reference).

**modules/media/config.yml:**
```yaml
---
# Media module
# Media processing and streaming tools

# Media processing dependencies
homebrew_packages:
  - ffmpeg        # Audio/video processing and conversion
  - imagemagick   # Image manipulation and conversion
  - streamlink    # Stream extraction from various services

# Note: This module provides:
# - ffmpeg for video/audio transcoding
# - ImageMagick for image processing (convert, mogrify, identify)
# - Streamlink for extracting streams from web services
# - ffmpeg brings many codec dependencies automatically
```

**modules/tmux/config.yml:**
```yaml
---
# Tmux module
# Terminal multiplexer for persistent sessions

# Tmux dependencies
homebrew_packages:
  - tmux                          # Terminal multiplexer
  - reattach-to-user-namespace    # macOS clipboard fix for tmux

# Note: This module provides:
# - tmux terminal multiplexer for session management
# - macOS clipboard integration via reattach-to-user-namespace
# - Enables persistent terminal sessions across SSH disconnects
```

**modules/go/config.yml:**
```yaml
---
# Go module
# Go programming language

# Go dependencies
homebrew_packages:
  - go  # Go programming language compiler and tools

# Note: This module provides:
# - Go compiler and standard library
# - go build, go test, go fmt, go vet tools
# - GOPATH and GOBIN environment (configure in .zshenv if needed)
```

**modules/security/config.yml:**
```yaml
---
# Security module
# GPG encryption and secret management tools

# Security dependencies
homebrew_packages:
  - gnupg        # GNU Privacy Guard (GPG encryption)
  - pinentry-mac # macOS-native GPG passphrase entry dialog
  - sops         # Mozilla SOPS encrypted file editor

# Note: This module provides:
# - GnuPG for encryption, signing, and key management
# - macOS Keychain-integrated pinentry for GPG passphrases
# - SOPS for encrypting/decrypting secret files (YAML, JSON, ENV)
```

**modules/database/config.yml:**
```yaml
---
# Database module
# Database servers for local development

# Database dependencies
homebrew_packages:
  - postgresql@14  # PostgreSQL relational database (version 14)

# Note: This module provides:
# - PostgreSQL 14 for local development databases
# - psql CLI client
# - Version pinned at 14 for compatibility with existing projects
```

Each file must:
1. Start with `---` YAML document separator
2. Have a module name comment and description
3. Use `homebrew_packages` key (not `homebrew_formulas`)
4. Include inline comments for each package
5. End with a descriptive `# Note:` block
  </action>
  <verify>
Run: `ls modules/media/config.yml modules/tmux/config.yml modules/go/config.yml modules/security/config.yml modules/database/config.yml` — all 5 files exist
Run: `grep "homebrew_packages" modules/media/config.yml modules/tmux/config.yml modules/go/config.yml modules/security/config.yml modules/database/config.yml` — all 5 have homebrew_packages
Verify no duplicate packages: `grep -rh "^  - " modules/*/config.yml | sed 's/^  - //' | sed 's/ *#.*//' | sort | uniq -d` — expect empty (no duplicates)
  </verify>
  <done>
Five new module directories exist with properly formatted config.yml files. Each module has a clear purpose, inline documentation, and no overlap with existing module declarations.
  </done>
</task>

</tasks>

<verification>
1. All formulas from audit "worth adding" list are declared in exactly one module config
2. No corporate packages (aws-sam-cli, awscli, azure-cli, cfn-lint, egctl, helm, teleport, vault, saml2aws, terraform-docs, mongocli, mongosh) appear in any config
3. Each config.yml is valid YAML (parseable)
4. No package appears in more than one module
5. yakitrak/yakitrak tap is declared in obsidian module alongside obsidian-cli
</verification>

<success_criteria>
- 4 existing modules updated with 14 new formula declarations total
- 5 new modules created with 9 formula declarations total
- Zero corporate or deprecated packages
- Zero duplicate declarations across modules
- All config.yml files follow existing project patterns
</success_criteria>

<output>
After completion, create `.planning/phases/06-homebrew-reconciliation/06-01-SUMMARY.md`
</output>
