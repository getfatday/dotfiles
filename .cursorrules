# Cursor Rules for Dotfiles Repository

This repository uses the `ansible-role-dotmodules` system for automated dotfile management and system configuration.

## Repository Structure

- **modules/**: Contains dotfile modules, each with:
  - `config.yml`: Module configuration (Homebrew packages, stow dirs, etc.)
  - `files/`: Dotfiles to be deployed via GNU Stow
- **playbooks/**: Ansible playbooks for deployment
- **README.md**: Documentation and usage instructions

## Key Concepts

### Module Configuration (`config.yml`)
Each module defines its dependencies and deployment settings:
- `homebrew_packages`: List of Homebrew packages to install
- `homebrew_taps`: List of Homebrew taps to add
- `homebrew_casks`: List of Homebrew casks to install
- `stow_dirs`: List of directories to deploy via GNU Stow
- `mas_installed_apps`: List of Mac App Store apps to install

### File Structure
- Use `files/` directory for all dotfiles
- Follow standard dotfile conventions (`.config/`, `.local/`, etc.)
- Use GNU Stow directory structure for clean deployment

## Development Guidelines

### Adding New Modules
1. Create module directory in `modules/`
2. Add `config.yml` with module configuration
3. Create `files/` directory with dotfiles
4. Test with Ansible playbook
5. Update documentation

### Modifying Existing Modules
1. Edit `config.yml` for dependency changes
2. Modify files in `files/` directory
3. Test changes with playbook
4. Commit changes with descriptive messages

### Testing
- Always test modules individually first
- Use `--check` mode for dry runs
- Verify Homebrew package lists
- Test GNU Stow deployment

## Common Tasks

### Creating a New Module
```bash
mkdir modules/new-module
touch modules/new-module/config.yml
mkdir modules/new-module/files
# Add configuration and files
```

### Testing a Module
```bash
ansible-playbook -i inventory test.yml --check
```

### Deploying Changes
```bash
ansible-playbook -i inventory playbook.yml
```

## File Patterns

- **Shell configs**: `.zshrc`, `.bashrc`, `.profile`
- **Git configs**: `.gitconfig`, `.gitignore`
- **Editor configs**: `.vimrc`, `.config/nvim/`
- **Language configs**: `.config/pip/`, `.config/npm/`
- **Scripts**: `.local/bin/`

## Dependencies

- Ansible 2.9+
- GNU Stow
- Homebrew (macOS)
- ansible-role-dotmodules role

## Best Practices

1. **Keep modules focused**: Each module should have a single purpose
2. **Document dependencies**: Clearly list all required packages
3. **Test thoroughly**: Verify all configurations work
4. **Use version control**: Track all changes
5. **Handle conflicts**: Be aware of potential configuration conflicts

## Troubleshooting

- Check Ansible role dependencies
- Verify GNU Stow installation
- Ensure Homebrew is working
- Check for existing dotfile conflicts
- Use verbose mode for debugging

## Current Modules

### Installed Modules
- **git**: Git configuration with aliases and `git open` command
- **macos**: macOS system configuration and Mac App Store apps
- **1password**: 1Password password manager
- **zsh**: Zsh shell with prezto framework
- **handbrake**: Handbrake video converter
- **finances**: Copilot Money personal finance app
- **node**: Node.js development with asdf and pnpm
- **iterm**: iTerm2 terminal with themes and profiles
- **alfred**: Alfred productivity app with workflows
- **obsidian**: Obsidian note-taking app with Web Clipper integration
- **chatgpt**: ChatGPT AI assistant desktop app
- **claude**: Claude AI assistant desktop app
- **cursor**: Cursor AI-powered code editor

### Obsidian Module Details
The Obsidian module provides a complete knowledge management system:
- **Applications**: Obsidian.app (Homebrew Cask) + Obsidian Web Clipper (Mac App Store)
- **Templates**: Daily notes, meeting notes, project notes, web clips
- **Configuration**: CSS snippets, setup scripts, vault management tools
- **Location**: `~/.config/obsidian/` (templates, snippets, scripts, plugins)
- **Scripts**: `~/.config/obsidian/scripts/setup-obsidian.sh`
- **Commands**: `obsidian`, `obsidian-vault`, `obsidian-templates`

## Deployment Verification

### Testing Process
1. **Dry Run**: `ansible-playbook -i inventory deploy.yml --check`
2. **Verify Apps**: Check `/Applications/` for installed apps
3. **Verify Configs**: Check `~/.config/` for deployed files
4. **Test Functionality**: Run setup scripts and verify commands work

### Common Issues
- **GNU Stow Conflicts**: Avoid `.local/bin/` conflicts between modules
- **Homebrew Permissions**: Sudo password required for Homebrew operations
- **Mac App Store**: Apps may already be installed (skipped in deployment)
- **Architecture Detection**: ARM64 vs x86_64 Homebrew paths

## Related Files

- `ansible-role-dotmodules/`: The core role implementation
- `tests/`: Test configurations and examples
- `playbooks/`: Deployment playbooks
- `modules/`: Individual dotfile modules
